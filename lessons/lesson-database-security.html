<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 6: Безопасность баз данных - Cortex Academy</title>
    <link rel="stylesheet" href="/hack.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono&display=swap" rel="stylesheet">
</head>
<body class="lesson-page">

    <header>
        <div class="logo">Cortex X</div>
        <nav>
            <a href="index.html">Главная</a>
            <a href="courses.html">Программа</a>
            <a href="#">Войти</a>
        </nav>
    </header>

    <div class="lesson-hero">
        <div class="lesson-hero-content">
            <span class="lesson-meta">Модуль 3 • Урок 6</span>
            <h1>Безопасность баз данных</h1>
            <p>Научитесь защищать самое ценное — данные. Мы разберем SQL, NoSQL, самые опасные атаки и многоуровневую стратегию защиты "Defense in Depth".</p>
        </div>
    </div>

    <main class="lesson-container">
        <!-- Боковая навигация по уроку -->
        <aside class="lesson-nav">
            <h3>Содержание урока</h3>
            <ul>
                <li><a href="#intro" class="nav-link active">1. Введение в базы данных</a></li>
                <li><a href="#sql-basics" class="nav-link">2. Реляционные БД и язык SQL</a></li>
                <li><a href="#exploitation" class="nav-link">3. Эксплуатация: SQL & NoSQL Injection</a></li>
                <li><a href="#secure-ops" class="nav-link">4. Безопасная эксплуатация и защита</a></li>
                <li><a href="#tech-solutions" class="nav-link">5. Технологические решения защиты</a></li>
                <li><a href="#task" class="nav-link">6. Практическое задание</a></li>
            </ul>
        </aside>

        <!-- Основной контент урока -->
        <article class="lesson-content">
            <section id="intro">
                <h2>1. Введение в базы данных: "Королевские драгоценности"</h2>
                <p>База данных (БД) — это организованное хранилище структурированной информации. Это не просто набор файлов, а сложная система (СУБД - Система Управления Базами Данных), которая обеспечивает быстрый доступ, целостность и управление данными.</p>
                <p>Для специалиста по кибербезопасности БД — это **главная цель**. В ней хранятся учетные данные пользователей, финансовая информация, персональные данные — все, что представляет ценность для атакующего. Защита периметра важна, но если ваша база данных уязвима, все остальные рубежи обороны теряют смысл.</p>
                <h3>Два основных типа баз данных:</h3>
                <ul>
                    <li><strong>Реляционные (SQL):</strong> Данные хранятся в строго структурированных таблицах, связанных между собой. Похоже на набор Excel-таблиц с жесткими правилами. Примеры: <strong>PostgreSQL, MySQL, Microsoft SQL Server</strong>.</li>
                    <li><strong>Нереляционные (NoSQL):</strong> Гибкие хранилища, где данные могут иметь различную структуру. Похоже на шкаф с папками, в каждой из которых лежит документ в своем формате. Примеры: <strong>MongoDB (документо-ориентированная), Redis (ключ-значение)</strong>.</li>
                </ul>
            </section>

            <section id="sql-basics">
                <h2>2. Реляционные базы данных и язык запросов SQL</h2>
                <p><strong>SQL (Structured Query Language)</strong> — это стандартный язык для общения с реляционными базами данных. Он делится на несколько подгрупп:</p>
                <ul>
                    <li><strong>DDL (Data Definition Language):</strong> Определение данных. Команды для создания и изменения структуры таблиц (<code>CREATE TABLE</code>, <code>ALTER TABLE</code>).</li>
                    <li><strong>DML (Data Manipulation Language):</strong> Манипуляция данными. Команды для работы с содержимым таблиц (<code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>).</li>
                    <li><strong>DCL (Data Control Language):</strong> Управление доступом к данным. Это самая важная часть для безопасности. Команды: <strong><code>GRANT</code> (выдать права)</strong> и <strong><code>REVOKE</code> (отозвать права)</strong>.</li>
                </ul>
                <div class="pro-tip-box">
                    <p><strong>PostgreSQL</strong> — одна из самых мощных, надежных и расширяемых open-source СУБД. Мы будем использовать ее в качестве основного примера для SQL.</p>
                </div>
                <div class="code-block">
                    <code>-- Пример DML: выбрать всех пользователей из таблицы 'users'
SELECT id, username, email FROM users WHERE is_active = TRUE;

-- Пример DCL: выдать пользователю 'reporter' права только на чтение таблицы 'sales'
GRANT SELECT ON TABLE sales TO reporter;

-- Отозвать у пользователя 'intern' права на удаление данных
REVOKE DELETE ON TABLE customers FROM intern;</code>
                    <button class="copy-btn">Копировать</button>
                </div>
            </section>

            <section id="exploitation">
                <h2>3. Эксплуатация: SQL & NoSQL Injection</h2>
                <p>Это самая известная и до сих пор одна из самых опасных атак на веб-приложения. Она возникает, когда приложение неверно обрабатывает пользовательский ввод и позволяет атакующему "внедрить" свой собственный SQL-код в запрос к базе данных.</p>
                <h3>Классическая SQL-инъекция</h3>
                <p>Представьте, что на сайте есть поле для ввода ID пользователя, и код формирует запрос так:</p>
                <code>$query = "SELECT * FROM users WHERE id = " + $user_input;</code>
                <p>Если честный пользователь введет `123`, запрос будет: <code>SELECT * FROM users WHERE id = 123</code>.</p>
                <p>Но что, если атакующий введет <code>123 OR 1=1</code>? Приложение склеит строку и отправит в базу данных убийственный запрос:</p>
                <div class="code-block">
                    <code>SELECT * FROM users WHERE id = 123 OR 1=1</code>
                    <button class="copy-btn">Копировать</button>
                </div>
                <p>Условие <code>1=1</code> всегда истинно, поэтому оператор <code>OR</code> сделает все выражение истинным, и база данных вернет <strong>ВСЕХ</strong> пользователей из таблицы, игнорируя ID.</p>
                <div class="warning-box">
                    <p><strong>Последствия SQL-инъекции:</strong> утечка всех данных, обход аутентификации, изменение и удаление данных, а в некоторых случаях — выполнение команд на сервере и полный захват системы.</p>
                </div>

                <h3>NoSQL-инъекция в MongoDB</h3>
                <p>MongoDB использует для запросов объекты в формате, похожем на JSON. Атака заключается во внедрении операторов MongoDB (таких как <code>$gt</code> - больше чем, <code>$ne</code> - не равно) в пользовательский ввод.</p>
                <p>Если код ожидает логин и пароль в виде <code>{ "user": "admin", "pass": "123" }</code>, атакующий может подсунуть в поле пароля объект <code>{ "$ne": "some_random_string" }</code>. Запрос превратится в "найти пользователя 'admin', у которого пароль НЕ равен 'some_random_string'", что, скорее всего, будет правдой, и аутентификация будет пройдена.</p>
            </section>
            
            <section id="secure-ops">
                <h2>4. Безопасная эксплуатация: Принципы защиты</h2>
                <p>Защита от инъекций и других атак — это многоуровневый процесс.</p>
                <ol>
                    <li><strong>Подготовленные выражения (Prepared Statements):</strong> Это главный метод защиты от SQL-инъекций. Код и данные передаются в базу данных раздельно. Сначала отправляется шаблон запроса с плейсхолдерами (<code>?</code>), а затем — данные, которые будут вставлены в эти плейсхолдеры. База данных никогда не спутает данные с кодом.</li>
                    <li><strong>Принцип наименьших привилегий (Principle of Least Privilege):</strong> Учетная запись, от имени которой приложение подключается к БД, должна иметь минимально необходимый набор прав. Если веб-приложению нужно только читать данные из таблицы `products`, дайте ему только `GRANT SELECT ON products`. Оно не должно иметь прав на удаление или изменение других таблиц.</li>
                    <li><strong>Валидация и очистка ввода (Input Validation & Sanitization):</strong> Всегда проверяйте данные, приходящие от пользователя. Если ожидается число — убедитесь, что это число. Удаляйте или экранируйте потенциально опасные символы.</li>
                </ol>
            </section>
            
            <section id="tech-solutions">
                <h2>5. Технологические решения защиты данных средствами СУБД</h2>
                <p>Современные СУБД предоставляют мощные встроенные инструменты для обеспечения безопасности.</p>
                <h3>Управление доступом (Access Control)</h3>
                <p><strong>Ролевая модель доступа (RBAC - Role-Based Access Control)</strong> — это стандарт де-факто. Вместо того чтобы выдавать права каждому пользователю по отдельности, вы создаете роли (например, `read_only_role`, `data_analyst_role`), наделяете их правами, а затем присваиваете эти роли пользователям. Это значительно упрощает управление.</p>

                <h3>Шифрование (Encryption)</h3>
                <p>Шифрование данных в БД бывает двух видов:</p>
                <ul>
                    <li><strong>Шифрование при передаче (Encryption in Transit):</strong> Защищает данные во время их путешествия по сети от клиента к серверу БД. Реализуется с помощью SSL/TLS. Вы должны всегда принудительно использовать зашифрованные соединения.</li>
                    <li><strong>Шифрование при хранении (Encryption at Rest):</strong> Защищает файлы самой базы данных на диске. Если злоумышленник физически украдет жесткий диск, он не сможет прочитать данные. Основная технология — <strong>TDE (Transparent Data Encryption)</strong>, которая шифрует данные "на лету" перед записью на диск и расшифровывает при чтении, будучи прозрачной для приложения.</li>
                </ul>

                <h3>Аудит и логирование (Auditing & Logging)</h3>
                <p>СУБД должна записывать все важные события в журнал аудита. Это позволяет отследить, кто, когда и к каким данным обращался, особенно при расследовании инцидентов. В PostgreSQL для этого используется расширение <code>pgaudit</code>.</p>
                <div class="pro-tip-box">
                    <p><strong>Что нужно логировать?</strong><br>
                    • Успешные и неудачные попытки входа.<br>
                    • Все DDL-операции (<code>CREATE</code>, <code>ALTER</code>, <code>DROP</code>).<br>
                    • Все DCL-операции (<code>GRANT</code>, <code>REVOKE</code>).<br>
                    • Доступ к критически важным таблицам (например, к таблице с пользователями).</p>
                </div>
                 <h3>Маскирование и анонимизация данных</h3>
                <p>Для тестовых и разработческих сред нельзя использовать реальные ("боевые") данные. Их нужно анонимизировать, заменяя персональную информацию (ФИО, email, телефоны) на сгенерированные, но правдоподобные данные. Некоторые СУБД имеют встроенные инструменты для динамического маскирования данных для определенных ролей.</p>
            </section>

            <section id="task">
                <h2>6. Практическое задание: Настройка безопасного доступа</h2>
                <p>Вы — администратор базы данных для нового блога. В PostgreSQL у вас есть таблица <code>articles (id, title, content, author_id, published_at)</code>. Вам нужно создать двух пользователей с разными уровнями доступа.</p>
                <p>Напишите SQL-команды (DCL) для выполнения следующих задач:</p>
                <ol>
                    <li>Создайте новую роль (пользователя) с именем `content_editor` с возможностью входа в систему и паролем.</li>
                    <li>Создайте новую роль `guest_reader` (без права входа, это будет роль-шаблон).</li>
                    <li>Дайте роли `content_editor` полные права на таблицу `articles` (чтение, вставка, обновление, удаление).</li>
                    <li>Дайте роли `guest_reader` права <strong>только на чтение</strong> (SELECT) таблицы `articles`.</li>
                    <li>Представьте, что `content_editor` уволился. Отзовите у него все права на таблицу `articles`.</li>
                    <li>Объясните одной фразой, почему нельзя давать веб-приложению права суперпользователя `postgres`.</li>
                </ol>
                <p>Это задание научит вас главному принципу безопасности БД: выдавать минимально необходимые привилегии и управлять доступом через роли.</p>
            </section>
        </article>
    </main>

    <footer>
        <p>&copy; 2024 Cortex Academy. Знания — это свобода.</p>
    </footer>

    <script src="/hack.js"></script>
</body>
</html>