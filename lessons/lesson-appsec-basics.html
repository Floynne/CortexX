<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 8: Защита приложений (AppSec) - Cortex Academy</title>
    <link rel="stylesheet" href="/hack.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono&display=swap" rel="stylesheet">
</head>
<body class="lesson-page">

    <header>
        <div class="logo">Cortex X</div>
        <nav>
            <a href="index.html">Главная</a>
            <a href="courses.html">Программа</a>
            <a href="#">Войти</a>
        </nav>
    </header>

    <div class="lesson-hero">
        <div class="lesson-hero-content">
            <span class="lesson-meta">Модуль 3 • Урок 8</span>
            <h1>Защита приложений: Мышление хакера</h1>
            <p>Научитесь находить и исправлять уязвимости в коде до того, как их найдут злоумышленники. Мы разберем классические атаки из OWASP Top 10 и методы защиты.</p>
        </div>
    </div>

    <main class="lesson-container">
        <!-- Боковая навигация по уроку -->
        <aside class="lesson-nav">
            <h3>Содержание урока</h3>
            <ul>
                <li><a href="#intro" class="nav-link active">1. Анализ защищенности (AppSec)</a></li>
                <li><a href="#sqli" class="nav-link">2. SQL-инъекции: Повторение</a></li>
                <li><a href="#xss" class="nav-link">3. Cross-Site Scripting (XSS)</a></li>
                <li><a href="#path-idor" class="nav-link">4. Path Traversal и IDOR</a></li>
                <li><a href="#csrf" class="nav-link">5. CSRF: Атака от чужого имени</a></li>
                <li><a href="#dependencies" class="nav-link">6. Уязвимости сторонних библиотек</a></li>
                <li><a href="#sast" class="nav-link">7. Статический анализ кода (SAST)</a></li>
                <li><a href="#waf" class="nav-link">8. Web Application Firewall (WAF)</a></li>
                <li><a href="#task" class="nav-link">9. Практическое задание</a></li>
            </ul>
        </aside>

        <!-- Основной контент урока -->
        <article class="lesson-content">
            <section id="intro">
                <h2>1. Анализ защищенности приложений: Введение в AppSec</h2>
                <p>Application Security (AppSec) — это процесс внедрения мер безопасности на всех этапах жизненного цикла разработки программного обеспечения (SDLC - Software Development Lifecycle). Основная идея — **"Shift Left"**, то есть "сдвиг влево". Мы должны находить и исправлять уязвимости как можно раньше — на этапе проектирования и написания кода, а не после того, как приложение уже взломали.</p>
                <div class="pro-tip-box">
                    <p><strong>OWASP (Open Web Application Security Project)</strong> — это ваш главный ресурс в мире AppSec. Их проект <strong>OWASP Top 10</strong> — это список десяти самых критических рисков для веб-приложений. Мы разберем многие из них сегодня.</p>
                </div>
                <p><strong>Мышление хакера:</strong> Никогда не доверяйте данным, приходящим от пользователя. Любое поле ввода, любой параметр в URL, любой cookie — это потенциальный вектор для атаки. Ваша задача — думать, как злоумышленник, и пытаться "сломать" приложение всеми возможными способами.</p>
            </section>

            <section id="sqli">
                <h2>2. SQL-инъекции: Повторение и углубление</h2>
                <p>Мы уже подробно разбирали эту атаку в уроке по безопасности баз данных. Это классический пример уязвимости, связанной с **внедрением кода (Injection)**. Давайте вспомним главное.</p>
                <ul>
                    <li><strong>Причина:</strong> Недоверие к пользовательскому вводу и "склеивание" SQL-запросов из строк.</li>
                    <li><strong>Последствия:</strong> От утечки всей базы данных до полного захвата сервера.</li>
                    <li><strong>Главная защита:</strong> <strong>Подготовленные выражения (Prepared Statements / Parameterized Queries)</strong>. Этот механизм разделяет код запроса и данные, делая инъекцию невозможной.</li>
                </ul>
                <div class="code-block">
                    <code># Уязвимый код на PHP
$id = $_GET['id'];
$query = "SELECT * FROM products WHERE id = " . $id;

# Безопасный код на PHP с использованием PDO
$stmt = $pdo->prepare('SELECT * FROM products WHERE id = :id');
$stmt->execute(['id' => $id]);</code>
                    <button class="copy-btn">Копировать</button>
                </div>
            </section>
            
            <section id="xss">
                <h2>3. Cross-Site Scripting (XSS): Атака на пользователей</h2>
                <p>XSS — это уязвимость, которая позволяет атакующему внедрить вредоносный JavaScript-код на веб-страницу, которую просматривают другие пользователи. В отличие от SQLi, которая атакует сервер, XSS атакует браузеры ваших пользователей.</p>
                <h3>Типы XSS:</h3>
                <ul>
                    <li><strong>Stored XSS (Хранимая):</strong> Самая опасная. Атакующий сохраняет вредоносный скрипт в базе данных (например, в комментарии на форуме или в своем профиле). Каждый, кто откроет эту страницу, выполнит скрипт.</li>
                    <li><strong>Reflected XSS (Отраженная):</strong> Скрипт внедряется через URL-параметр. Например, в строке поиска. Атакующий должен заставить жертву перейти по специально сформированной ссылке.</li>
                    <li><strong>DOM-based XSS:</strong> Уязвимость находится в клиентском JavaScript-коде, который неправильно обрабатывает данные из URL и вставляет их в HTML-код страницы (DOM).</li>
                </ul>
                <div class="warning-box">
                    <p><strong>Что может сделать XSS?</strong> Украсть cookie-файлы сессии пользователя (и зайти под его именем), перехватить ввод с клавиатуры (кейлоггер), перенаправить на фишинговый сайт, изменить содержимое страницы.</p>
                </div>
                <h3>Защита от XSS:</h3>
                <p><strong>Экранирование вывода (Output Encoding):</strong> Это главная защита. Перед тем как вставить любые данные, полученные от пользователя, в HTML-страницу, вы должны преобразовать специальные символы в их безопасные HTML-эквиваленты. <code><</code> становится <code>&lt;</code>, <code>></code> становится <code>&gt;</code>, <code>"</code> становится <code>&quot;</code>.</p>
                <div class="code-block">
                    <code><!-- Уязвимый код (PHP): выводит имя пользователя без обработки -->
<h1>Добро пожаловать, <?php echo $_GET['username']; ?>!</h1>
<!-- Если username=<script>alert('XSS')</script>, скрипт выполнится -->

<!-- Безопасный код (PHP): все спецсимволы будут преобразованы -->
<h1>Добро пожаловать, <?php echo htmlspecialchars($_GET['username']); ?>!</h1></code>
                    <button class="copy-btn">Копировать</button>
                </div>
            </section>

            <section id="path-idor">
                <h2>4. Path Traversal и IDOR: Атаки на контроль доступа</h2>
                <h3>Path Traversal (Обход каталога)</h3>
                <p>Эта атака позволяет атакующему читать файлы за пределами корневой директории веб-сервера. Она возникает, когда имя файла передается в URL, и приложение не проверяет путь.</p>
                <p>Предположим, URL для скачивания файла выглядит так: `https://example.com/download.php?file=report.pdf`. Атакующий может попытаться выйти на уровень выше, используя `../`.</p>
                <div class="code-block">
                    <code># Попытка прочитать системный файл с паролями
https://example.com/download.php?file=../../../../etc/passwd</code>
                    <button class="copy-btn">Копировать</button>
                </div>
                <p><strong>Защита:</strong> Никогда не доверяйте именам файлов от пользователя. Проверяйте, что путь к файлу не содержит `../` и находится внутри разрешенной директории.</p>
                
                <h3>IDOR (Insecure Direct Object References)</h3>
                <p>Небезопасные прямые ссылки на объекты. Это уязвимость контроля доступа, когда приложение позволяет пользователю получить доступ к чужим данным, просто изменив ID в URL.</p>
                <p>Например, вы заходите в свой профиль по адресу `https://example.com/profile?id=123`. Если вы измените URL на `https://example.com/profile?id=124` и увидите профиль другого пользователя — это IDOR.</p>
                <p><strong>Защита:</strong> На сервере, перед тем как отдать любые данные, всегда проверяйте, имеет ли <strong>текущий аутентифицированный пользователь</strong> право на доступ к <strong>запрашиваемому объекту</strong>.</p>
            </section>

            <section id="csrf">
                <h2>5. CSRF: Атака от чужого имени</h2>
                <p><strong>Cross-Site Request Forgery (Межсайтовая подделка запроса)</strong> — это атака, которая заставляет браузер аутентифицированного пользователя выполнить нежелательное действие на другом сайте. Злоумышленник обманом заставляет браузер жертвы отправить запрос (например, на перевод денег или смену пароля) на уязвимый сайт.</p>
                <p><strong>Как это работает:</strong></p>
                <ol>
                    <li>Вы залогинены в своем онлайн-банке.</li>
                    <li>Вы открываете в другой вкладке вредоносный сайт (или даже письмо с картинкой).</li>
                    <li>На этом сайте есть скрытая форма или картинка, чей `src` ведет на URL для перевода денег в вашем банке: `https://mybank.com/transfer?to=attacker&amount=1000`.</li>
                    <li>Ваш браузер автоматически прикрепит к этому запросу ваши cookie-файлы для `mybank.com`, и банк выполнит перевод, думая, что это сделали вы.</li>
                </ol>
                <h3>Защита от CSRF: Anti-CSRF токены</h3>
                <p>Это самый надежный метод. Сервер генерирует случайный, уникальный токен для каждой сессии пользователя и встраивает его в скрытое поле каждой формы. Когда форма отправляется, сервер проверяет, совпадает ли присланный токен с тем, который хранится в сессии. Атакующий не может угадать этот токен, поэтому его поддельный запрос будет отклонен.</p>
            </section>

            <section id="dependencies">
                <h2>6. Уязвимости сторонних библиотек</h2>
                <p>Современные приложения на 80-90% состоят из кода, который вы не писали — из сторонних библиотек, фреймворков и зависимостей. Это огромный вектор для атаки. Если в популярной библиотеке (например, Log4j, OpenSSL) находят уязвимость, миллионы приложений по всему миру становятся уязвимыми.</p>
                <div class="info-box">
                    <p>Эта категория в OWASP Top 10 называется <strong>"Vulnerable and Outdated Components"</strong> (Уязвимые и устаревшие компоненты).</p>
                </div>
                <h3>Защита: SCA (Software Composition Analysis)</h3>
                <p>Вы должны постоянно сканировать свой проект на наличие уязвимых зависимостей. Для этого существуют автоматизированные инструменты (SCA-сканеры), такие как:</p>
                <ul>
                    <li><strong>OWASP Dependency-Check</strong> (open-source)</li>
                    <li><strong>Snyk</strong></li>
                    <li><strong>GitHub Dependabot</strong> (встроен в GitHub)</li>
                </ul>
                <p>Эти инструменты сверяют версии библиотек в вашем проекте с глобальными базами данных уязвимостей (CVE) и предупреждают вас, если нужно обновиться.</p>
            </section>

            <section id="sast">
                <h2>7. Статический анализ кода (SAST)</h2>
                <p><strong>SAST (Static Application Security Testing)</strong> — это "белый ящик" для анализа безопасности. Это автоматизированный процесс анализа исходного кода приложения без его запуска. SAST-сканер работает как очень придирчивый рецензент, который ищет в коде паттерны, указывающие на потенциальные уязвимости (SQL-инъекции, XSS, небезопасные функции).</p>
                <p><strong>Плюсы:</strong> Позволяет находить уязвимости на самых ранних этапах. Показывает точное место в коде, где находится проблема.<br>
                <strong>Минусы:</strong> Может давать много ложных срабатываний (false positives). Не может найти уязвимости, связанные с логикой или конфигурацией.</p>
                <p>Популярные SAST-инструменты: <strong>SonarQube, Checkmarx, CodeQL (от GitHub)</strong>.</p>
            </section>

            <section id="waf">
                <h2>8. Web Application Firewall (WAF): Последний рубеж обороны</h2>
                <p><strong>WAF</strong> — это специализированный файрвол, который работает на прикладном уровне (L7). Он располагается между пользователями и вашим веб-сервером и анализирует весь HTTP/HTTPS трафик на наличие признаков атак (SQLi, XSS, Path Traversal и др.).</p>
                <p>WAF — это не "серебряная пуля". Он является важным, но последним эшелоном защиты. Вы не должны полагаться только на него. Главное — исправлять уязвимости в самом коде.</p>
                <div class="warning-box">
                    <p>Неправильно настроенный WAF может блокировать легитимных пользователей или его можно обойти с помощью техник обфускации. Но хорошо настроенный WAF может спасти вас от атак "нулевого дня", пока вы не выпустили патч.</p>
                </div>
                <p>Популярные WAF: <strong>ModSecurity (open-source), Cloudflare WAF, AWS WAF</strong>.</p>
            </section>

            <section id="task">
                <h2>9. Практическое задание: Анализ уязвимого кода</h2>
                <p>Ниже приведен фрагмент кода на PHP для простого блога. Ваша задача — провести его аудит и найти как можно больше уязвимостей из тех, что мы сегодня изучили.</p>
                <div class="code-block">
                    <code><?php
// connect_db.php - Подключение к БД
$db = new mysqli("localhost", "app_user", "password123", "blog_db");

// profile.php - Показывает профиль пользователя
$userId = $_COOKIE['user_id'];
$result = $db->query("SELECT * FROM users WHERE id = $userId");
$user = $result->fetch_assoc();
echo "<h1>Профиль: " . $user['username'] . "</h1>";

// search.php - Поиск по статьям
$searchTerm = $_GET['q'];
echo "<h2>Результаты поиска для: $searchTerm</h2>";
$result = $db->query("SELECT title FROM articles WHERE content LIKE '%$searchTerm%'");

// download.php - Скачивание аватара
$file = $_GET['avatar'];
readfile("/var/www/html/avatars/" . $file);
?></code>
                    <button class="copy-btn">Копировать</button>
                </div>
                <p><strong>Задание:</strong></p>
                <ol>
                    <li>Найдите в этом коде как минимум <strong>три</strong> разные уязвимости.</li>
                    <li>Для каждой уязвимости укажите ее тип (например, Stored XSS, SQLi, ...).</li>
                    <li>Кратко опишите, как атакующий мог бы ее проэксплуатировать.</li>
                    <li>Предложите, как исправить каждую из этих уязвимостей.</li>
                </ol>
                <p>Это задание проверит вашу способность "читать" код глазами специалиста по безопасности и применять теоретические знания на практике.</p>
            </section>
        </article>
    </main>

    <footer>
        <p>&copy; 2024 Cortex Academy. Знания — это свобода.</p>
    </footer>

    <script src="/hack.js"></script>
</body>
</html>